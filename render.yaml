services:
  - type: web
    name: mi-neo4j-db
    env: docker
    # CORRECCIÓN 1: La imagen es una cadena de texto, no una lista.
    image: neo4j:5-community
    plan: free
    disk:
      name: neo4j-data
      mountPath: /data
      sizeGB: 1
    envVars:
      - key: NEO4J_AUTH
        value: neo4j/tu_contraseña_muy_segura
        sync: false
      - key: NEO4J_PLUGINS
        value: '["apoc"]'
        sync: false
      - key: NEO4J_dbms_memory_heap_initial__size
        value: 256m
        sync: false
      - key: NEO4J_dbms_memory_heap_max__size
        value: 256m
        sync: false
      - key: NEO4J_dbms_memory_pagecache_size
        value: 128m
        sync: false
      - key: NEO4J_dbms_default__listen__address
        value: 0.0.0.0
        sync: false
      - key: NEO4J_dbms_connector_bolt_listen__address
        value: 0.0.0.0:7687
        sync: false
      - key: NEO4J_dbms_connector_http_listen__address
        value: 0.0.0.0:7474
        sync: false
      - key: NEO4J_dbms_security_procedures_unrestricted
        value: apoc.*
        sync: false
      - key: NEO4J_dbms_security_procedures_allowlist
        value: apoc.*
        sync: false
    # CORRECCIÓN 2: La forma correcta de definir un health check complejo
    # es usando un objeto anidado bajo la clave "httpCheck".
    httpCheck:
      # Este endpoint responde rápido y es ideal para verificar que Neo4j está vivo.
      path: /db/manage/server/jmx/domain/java.lang
      initialDelaySeconds: 60
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 5
